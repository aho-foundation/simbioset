# –ê–Ω–∞–ª–∏–∑ —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ —Å–≤–æ–π—Å—Ç–≤ –≤ Weaviate —Å AutoSchema

## –û–±–∑–æ—Ä

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (–∫–æ–ª–ª–µ–∫—Ü–∏–π) –∏ –∏—Ö —Å–≤–æ–π—Å—Ç–≤ –≤ —Å–∏–º–±–∏–æ—Å–µ—Ç–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–π Weaviate —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π AutoSchema.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π

### –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### 1. –£—Ä–æ–≤–µ–Ω—å Weaviate —Å–µ—Ä–≤–µ—Ä–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Weaviate —Å–µ—Ä–≤–µ—Ä–∞:

```bash
AUTOSCHEMA_ENABLED=true              # –í–∫–ª—é—á–∏—Ç—å AutoSchema –≤ Weaviate
AUTOSCHEMA_DEFAULT_NUMBER=number     # –¢–∏–ø –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
AUTOSCHEMA_DEFAULT_DATE=date         # –¢–∏–ø –¥–ª—è –¥–∞—Ç–æ–ø–æ–¥–æ–±–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
```

**–ú–µ—Å—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Weaviate: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- Dokku: `dokku config:set weaviate AUTOSCHEMA_ENABLED=true`

#### 2. –£—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```python
# api/settings.py
WEAVIATE_USE_BUILTIN_AUTOSCHEMA = True  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é AutoSchema
WEAVIATE_AUTOSCHEMA_DEFAULT_NUMBER = "number"
WEAVIATE_AUTOSCHEMA_DEFAULT_DATE = "date"
```

**–õ–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# api/storage/weaviate_storage.py:122-133
if WEAVIATE_USE_BUILTIN_AUTOSCHEMA:
    log("ü§ñ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è AutoSchema Weaviate –∞–∫—Ç–∏–≤–Ω–∞ - —Å—Ö–µ–º–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö")
    log("üìà –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–∏–º–±–∏–æ—Å–µ—Ç–∏: —Å–≤—è–∑–∏ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –º–æ–≥—É—Ç —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏")
else:
    log("üîß –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π - —Å–æ–∑–¥–∞–µ–º –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å—Ö–µ–º—É")
    create_schema_if_not_exists(self.client)
    if update_schema_if_needed(self.client):
        log("üîÑ –°—Ö–µ–º–∞ –±—ã–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞")
```

## –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏

**–ú–µ—Ç–æ–¥:** `_paragraph_to_weaviate_object(paragraph: Paragraph) -> Dict[str, Any]`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `api/storage/weaviate_storage.py:174-201`

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Paragraph:**
   ```python
   # –ò–∑–≤–ª–µ–∫–∞–µ–º organism_ids –∏–∑ metadata (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
   organism_ids = paragraph.metadata.get("organism_ids", []) if paragraph.metadata else []
   ```

2. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è —Å–≤–æ–π—Å—Ç–≤:**
   ```python
   obj = {
       "content": paragraph.content,
       "document_id": paragraph.document_id or "",
       "node_id": paragraph.node_id or "",
       "document_type": paragraph.document_type.value if paragraph.document_type else "chat",
       "organism_ids": organism_ids,
       "ecosystem_id": paragraph.ecosystem_id or "",
       "location": paragraph.location or "",
       "tags": paragraph.tags or [],
       "author": paragraph.author or "",
       "author_id": paragraph.author_id or 0,
       "paragraph_index": paragraph.paragraph_index or 0,
   }
   ```

3. **–£—Å–ª–æ–≤–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ timestamp:**
   ```python
   if paragraph.timestamp:
       obj["timestamp"] = paragraph.timestamp.isoformat()
   ```

**–í–∞–∂–Ω–æ:**
- –ú–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞**, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –æ–±—ä–µ–∫—Ç Weaviate
- –ù–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `Paragraph` –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ
- `metadata` –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é - –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ DataObject

**–ú–µ—Ç–æ–¥:** `add_documents()` –∏–ª–∏ `add_chat_messages()`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `api/storage/weaviate_storage.py:783-875` –∏ `877-968`

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è batch insert:**
   ```python
   from weaviate.classes.data import DataObject
   
   collection = self.client.collections.get(WEAVIATE_CLASS_NAME)
   objects_to_insert = []
   
   for paragraph in paragraphs:
       # –°–æ–∑–¥–∞–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
       if paragraph.embedding is None:
           paragraph.embedding = self._create_embedding(paragraph.content)
       
       # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º Paragraph –≤ —Å–ª–æ–≤–∞—Ä—å —Å–≤–æ–π—Å—Ç–≤
       obj = self._paragraph_to_weaviate_object(paragraph)
       vector = paragraph.embedding.tolist()
       
       # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º UUID
       para_uuid = paragraph.id.replace("para_", "") if paragraph.id.startswith("para_") else paragraph.id
       try:
           para_uuid_obj = uuid.UUID(para_uuid)
       except (ValueError, AttributeError):
           para_uuid_obj = uuid.uuid4()
       
       # –°–æ–∑–¥–∞–µ–º DataObject –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏
       objects_to_insert.append(
           DataObject(
               uuid=para_uuid_obj,
               properties=obj,  # –°–ª–æ–≤–∞—Ä—å —Å–≤–æ–π—Å—Ç–≤
               vector=vector,   # –í–µ–∫—Ç–æ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
           )
       )
   ```

2. **Batch –≤—Å—Ç–∞–≤–∫–∞:**
   ```python
   batch_size = WEAVIATE_BATCH_SIZE  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 500
   for i in range(0, len(objects_to_insert), batch_size):
       batch = objects_to_insert[i : i + batch_size]
       result = collection.data.insert_many(batch)
       added_count += len(batch)
   ```

### –®–∞–≥ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (AutoSchema)

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –≤—Å—Ç–∞–≤–∫–µ –æ–±—ä–µ–∫—Ç–∞ –≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
- Weaviate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é —Å –∏–º–µ–Ω–µ–º –∏–∑ `WEAVIATE_CLASS_NAME` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "Paragraph")

**–ü—Ä–æ—Ü–µ—Å—Å –≤ Weaviate:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏:**
   ```python
   collection = self.client.collections.get(WEAVIATE_CLASS_NAME)
   # –ï—Å–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, Weaviate —Å–æ–∑–¥–∞—Å—Ç –µ—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   ```

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã:**
   - Weaviate –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç –≤ batch
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞
   - –°–æ–∑–¥–∞–µ—Ç —Å—Ö–µ–º—É –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å —ç—Ç–∏–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏

### –®–∞–≥ 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ —Å –Ω–æ–≤—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º–µ
- Weaviate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ —Å—Ö–µ–º—É –∫–æ–ª–ª–µ–∫—Ü–∏–∏

**–ü—Ä–æ—Ü–µ—Å—Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ —Ç–∏–ø–æ–≤:**

Weaviate –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤–∞:

| Python —Ç–∏–ø | Weaviate —Ç–∏–ø | –ü—Ä–∏–º–µ—Ä |
|------------|--------------|--------|
| `str` | `text` | `"—Ç–µ–∫—Å—Ç"` |
| `int` | `int` | `42` |
| `float` | `number` | `3.14` |
| `bool` | `boolean` | `True` |
| `datetime` / ISO string | `date` | `"2024-01-01T10:00:00Z"` |
| `list[str]` | `text[]` | `["tag1", "tag2"]` |
| `list[int]` | `int[]` | `[1, 2, 3]` |
| `list[float]` | `number[]` | `[1.1, 2.2]` |
| `dict` | `object` | `{"key": "value"}` |

**–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞:**

```python
# –ü–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å –±–∞–∑–æ–≤—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏
obj1 = {
    "content": "—Ç–µ–∫—Å—Ç",
    "author": "–∞–≤—Ç–æ—Ä",
    "tags": ["tag1"]
}
# ‚Üí –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–ª–ª–µ–∫—Ü–∏—è Paragraph —Å properties: content (text), author (text), tags (text[])

# –í—Ç–æ—Ä–æ–π –æ–±—ä–µ–∫—Ç —Å –Ω–æ–≤—ã–º —Å–≤–æ–π—Å—Ç–≤–æ–º
obj2 = {
    "content": "—Ç–µ–∫—Å—Ç",
    "author": "–∞–≤—Ç–æ—Ä",
    "tags": ["tag1"],
    "confidence_score": 0.95,  # –ù–û–í–û–ï –°–í–û–ô–°–¢–í–û
    "discovery_date": "2024-01-01"  # –ù–û–í–û–ï –°–í–û–ô–°–¢–í–û
}
# ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è:
#    - confidence_score (number)
#    - discovery_date (date)
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –≤ –∫–æ–¥–µ

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ Weaviate —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏:
  1. –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –æ–±—ä–µ–∫—Ç–µ `Paragraph`
  2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `_paragraph_to_weaviate_object()`

**–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞:**

```python
# 1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ Paragraph (api/storage/faiss.py)
class Paragraph:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    new_field: Optional[str] = None

# 2. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤ _paragraph_to_weaviate_object
def _paragraph_to_weaviate_object(self, paragraph: Paragraph) -> Dict[str, Any]:
    obj = {
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
        "new_field": paragraph.new_field or "",
    }
    return obj

# 3. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ —Å new_field, Weaviate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
#    - –û–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø (str ‚Üí text)
#    - –î–æ–±–∞–≤–∏—Ç —Å–≤–æ–π—Å—Ç–≤–æ –≤ —Å—Ö–µ–º—É –∫–æ–ª–ª–µ–∫—Ü–∏–∏
#    - –°–æ—Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–±—ä–µ–∫—Ç–µ
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- AutoSchema –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ "–Ω–∞ –ª–µ—Ç—É"
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö —Å—Ö–µ–º—ã
- –¢–∏–ø—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ç–∏–ø–æ–≤:**
   ```
   Error: property "field_name" already exists with different type
   ```
   - –í–æ–∑–Ω–∏–∫–∞–µ—Ç, –µ—Å–ª–∏ –ø—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ —Å –¥—Ä—É–≥–∏–º —Ç–∏–ø–æ–º
   - –†–µ—à–µ–Ω–∏–µ: —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–µ–µ —Å–≤–æ–π—Å—Ç–≤–æ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö

2. **–û–ø–µ—á–∞—Ç–∫–∏ –≤ –∏–º–µ–Ω–∞—Ö —Å–≤–æ–π—Å—Ç–≤:**
   - AutoSchema —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –¥–∞–∂–µ –ø—Ä–∏ –æ–ø–µ—á–∞—Ç–∫–µ
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å schema-first –¥–ª—è production

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ò–Ω—Ñ–µ—Ä–µ–Ω—Å —Ç–∏–ø–æ–≤ –¥–æ–±–∞–≤–ª—è–µ—Ç overhead
   - –î–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ —Å—Ö–µ–º—ã

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –±–∞–∑–æ–≤—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏

```python
storage = WeaviateStorage()

documents = [
    {"text": "–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö"}
]

# –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ:
# 1. –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–ª–ª–µ–∫—Ü–∏—è "Paragraph" (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
# 2. –°–æ–∑–¥–∞—é—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ _paragraph_to_weaviate_object:
#    - content (text)
#    - document_id (text)
#    - document_type (text)
#    - author (text)
#    - author_id (int)
#    - tags (text[])
#    - –∏ —Ç.–¥.

storage.add_documents(
    documents,
    document_id="doc_1",
    document_type=DocumentType.KNOWLEDGE
)
```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ —Å –Ω–æ–≤—ã–º —Å–≤–æ–π—Å—Ç–≤–æ–º

```python
# –ï—Å–ª–∏ –≤ _paragraph_to_weaviate_object –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è:
def _paragraph_to_weaviate_object(self, paragraph: Paragraph) -> Dict[str, Any]:
    obj = {
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
        "confidence_score": getattr(paragraph, 'confidence_score', None) or 0.0,
    }
    return obj

# –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞:
# 1. Weaviate –æ–±–Ω–∞—Ä—É–∂–∏—Ç –Ω–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ "confidence_score"
# 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø: float ‚Üí number
# 3. –î–æ–±–∞–≤–∏—Ç —Å–≤–æ–π—Å—Ç–≤–æ –≤ —Å—Ö–µ–º—É –∫–æ–ª–ª–µ–∫—Ü–∏–∏
# 4. –°–æ—Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–±—ä–µ–∫—Ç–µ
```

### –ü—Ä–∏–º–µ—Ä 3: Batch –≤—Å—Ç–∞–≤–∫–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏

```python
# –û–±—ä–µ–∫—Ç 1: –±–∞–∑–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
para1 = Paragraph(
    content="—Ç–µ–∫—Å—Ç 1",
    author="–∞–≤—Ç–æ—Ä",
    tags=["tag1"]
)

# –û–±—ä–µ–∫—Ç 2: —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏
para2 = Paragraph(
    content="—Ç–µ–∫—Å—Ç 2",
    author="–∞–≤—Ç–æ—Ä",
    tags=["tag2"],
    location="–ú–æ—Å–∫–≤–∞",  # –ù–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ
    ecosystem_id="eco_1"  # –ù–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ
)

# –ü—Ä–∏ batch –≤—Å—Ç–∞–≤–∫–µ:
# 1. –ü–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ö–µ–º—É —Å –±–∞–∑–æ–≤—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏
# 2. –í—Ç–æ—Ä–æ–π –æ–±—ä–µ–∫—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç location –∏ ecosystem_id –≤ —Å—Ö–µ–º—É
# 3. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º—ã

```bash
# –ß–µ—Ä–µ–∑ HTTP API
curl http://weaviate:8080/v1/schema

# –ß–µ—Ä–µ–∑ Python –∫–ª–∏–µ–Ω—Ç
from api.storage.weaviate_storage import WeaviateStorage
storage = WeaviateStorage()
schema = storage.client.schema.get()
print(schema)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏

```bash
curl http://weaviate:8080/v1/schema/Paragraph
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–í –∫–æ–¥–µ:**
```python
# api/storage/weaviate_storage.py:830
log(f"üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ {len(paragraphs)} –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –≤ Weaviate –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ {document_id}...")

# –ü–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏
log(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {added_count} –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –≤ Weaviate –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ {document_id}")
```

**–í –ª–æ–≥–∞—Ö Weaviate:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤
- –û—à–∏–±–∫–∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ —Ç–∏–ø–æ–≤

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (AutoSchema)

‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AutoSchema –∫–æ–≥–¥–∞:**
- –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã (–∫–∞–∫ —Å–∏–º–±–∏–æ—Å–µ—Ç—å)
- –ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–µ–π—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –ë—ã—Å—Ç—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è

### –î–ª—è production (Schema-First)

‚úÖ **–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ Schema-First –∫–æ–≥–¥–∞:**
- –°—Ö–µ–º–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å
- –ù—É–∂–µ–Ω —Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤
- –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–º–µ–Ω—å—à–µ overhead)
- –ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º—ã)

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å AutoSchema –Ω–∞ Schema-First

1. **–≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º—ã:**
   ```python
   schema = storage.client.schema.get()
   # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
   ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ —è–≤–Ω–æ–π —Å—Ö–µ–º—ã:**
   ```python
   # –û—Ç–∫–ª—é—á–∏—Ç—å AutoSchema
   WEAVIATE_USE_BUILTIN_AUTOSCHEMA = False
   
   # –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É –≤—Ä—É—á–Ω—É—é
   create_schema_if_not_exists(storage.client)
   ```

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ö–µ–º–µ
   - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è —è–≤–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ —Å–≤–æ–π—Å—Ç–≤ –≤ Weaviate —Å AutoSchema:

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:** `_paragraph_to_weaviate_object()` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å–≤–æ–π—Å—Ç–≤
2. **–í—Å—Ç–∞–≤–∫–∞:** `collection.data.insert_many()` –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã –±–∞—Ç—á–∞–º–∏
3. **–ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ:** Weaviate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—ä–µ–∫—Ç–µ
4. **–ê–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ:** –ù–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å—Ö–µ–º—É —Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–æ–º —Ç–∏–ø–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º—ã
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö
- –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ç–∏–ø–æ–≤
- Overhead –Ω–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å
- –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö
