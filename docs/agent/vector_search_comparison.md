# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π: FAISS vs pgvector vs Qdrant

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | FAISS | pgvector | Qdrant |
|----------|-------|----------|--------|
| **–¢–∏–ø** | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–≤ –ø–∞–º—è—Ç–∏) | –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL | –û—Ç–¥–µ–ª—å–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤** | RAM + –ë–î (BLOB) | PostgreSQL (—Ç–∏–ø `vector`) | Qdrant (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ) |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** | SQLite/PostgreSQL | PostgreSQL (–≤–º–µ—Å—Ç–µ) | Qdrant (–≤–º–µ—Å—Ç–µ) |
| **–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞** | ‚ö°‚ö°‚ö° –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è | ‚ö°‚ö° –ë—ã—Å—Ç—Ä–∞—è | ‚ö°‚ö°‚ö° –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ RAM | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ PostgreSQL | ‚úÖ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | üî¥ –í—ã—Å–æ–∫–∞—è (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è) | üü¢ –ù–∏–∑–∫–∞—è (SQL) | üü° –°—Ä–µ–¥–Ω—è—è (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å) |
| **ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ |
| **SQL –∑–∞–ø—Ä–æ—Å—ã** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç (REST API) |
| **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** | ‚ö†Ô∏è –í—Ä—É—á–Ω—É—é | ‚úÖ SQL WHERE | ‚úÖ –§–∏–ª—å—Ç—Ä—ã –≤ API |
| **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ | ‚úÖ SQL + –≤–µ–∫—Ç–æ—Ä | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω |
| **–†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞** | RAM –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ | –î–∏—Å–∫ + RAM | –î–∏—Å–∫ + RAM |
| **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è** | ‚ùå –ù–µ—Ç | ‚úÖ PostgreSQL | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–∞ |

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

### FAISS (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)
**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ù–µ–±–æ–ª—å—à–∏–µ/—Å—Ä–µ–¥–Ω–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (< 10M –≤–µ–∫—Ç–æ—Ä–æ–≤)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞
- –î–∞–Ω–Ω—ã–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ RAM
- –ù—É–∂–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å –≤ –≤—ã–±–æ—Ä–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (> 10M –≤–µ–∫—Ç–æ—Ä–æ–≤)
- –ù—É–∂–Ω—ã ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ª–æ–∂–Ω–∞)
- –ù—É–∂–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è/–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
FAISS (RAM) ‚Üê‚Üí SQLite/PostgreSQL (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ + BLOB)
     ‚Üì
  –ü–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏ ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
```

### pgvector
**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –°—Ä–µ–¥–Ω–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (< 100M –≤–µ–∫—Ç–æ—Ä–æ–≤)
- –ù—É–∂–Ω—ã SQL –∑–∞–ø—Ä–æ—Å—ã —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- –ù—É–∂–Ω—ã ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ (–≤—Å–µ –≤ –æ–¥–Ω–æ–π –ë–î)
- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (—Ç–µ–∫—Å—Ç + –≤–µ–∫—Ç–æ—Ä)

**‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –û—á–µ–Ω—å –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã (> 100M –≤–µ–∫—Ç–æ—Ä–æ–≤)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞
- –ù—É–∂–Ω–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```sql
-- –í—Å–µ –≤ PostgreSQL
CREATE TABLE paragraphs (
    id TEXT PRIMARY KEY,
    content TEXT,
    embedding vector(384),  -- –í–µ–∫—Ç–æ—Ä –ø—Ä—è–º–æ –≤ –ë–î
    tags TEXT[]
);

-- –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ SQL
SELECT content, embedding <-> query_vector AS distance
FROM paragraphs
WHERE tags @> ARRAY['ecosystem_risk']
ORDER BY distance
LIMIT 10;
```

### Qdrant
**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (> 100M –≤–µ–∫—Ç–æ—Ä–æ–≤)
- –ù—É–∂–Ω–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î

**‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ù—É–∂–Ω—ã SQL –∑–∞–ø—Ä–æ—Å—ã
- –ù—É–∂–Ω—ã —Å–ª–æ–∂–Ω—ã–µ ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–µ–∫—Ç—ã (overkill)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
PostgreSQL (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ) ‚Üê‚Üí Qdrant (–≤–µ–∫—Ç–æ—Ä—ã + –ø–æ–∏—Å–∫)
                              ‚Üì
                    REST API –¥–ª—è –ø–æ–∏—Å–∫–∞
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å FAISS –Ω–∞ pgvector

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:
1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –í—Å–µ –≤ –æ–¥–Ω–æ–π –ë–î, –Ω–µ –Ω—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
2. **SQL –∑–∞–ø—Ä–æ—Å—ã**: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (—Ç–µ–∫—Å—Ç + –≤–µ–∫—Ç–æ—Ä) —á–µ—Ä–µ–∑ SQL
3. **ACID**: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
4. **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞**: –ù–µ –Ω—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è FAISS ‚Üî –ë–î

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
1. **–°–∫–æ—Ä–æ—Å—Ç—å**: –ú–µ–¥–ª–µ–Ω–Ω–µ–µ FAISS (–Ω–æ –≤—Å–µ –µ—â–µ –±—ã—Å—Ç—Ä–æ)
2. **–†–∞–∑–º–µ—Ä –ë–î**: –í–µ–∫—Ç–æ—Ä—ã –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ –≤ PostgreSQL
3. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ PostgreSQL

### –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏:

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (FAISS):**
```python
# 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
cursor.execute("INSERT INTO vectors (embedding) VALUES (?)", (vector.tobytes(),))

# 2. –î–æ–±–∞–≤–ª—è–µ–º –≤ FAISS
faiss_index.add(vector)

# 3. –ü–æ–∏—Å–∫ –≤ FAISS
distances, indices = faiss_index.search(query_vector, k=10)

# 4. –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
paragraph_ids = [faiss_paragraph_ids[i] for i in indices[0]]
```

**–° pgvector:**
```python
# 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ PostgreSQL (–≤—Å–µ —Å—Ä–∞–∑—É)
cursor.execute(
    "INSERT INTO paragraphs (content, embedding) VALUES (%s, %s)",
    (content, vector.tolist())
)

# 2. –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ SQL (–≤—Å–µ —Å—Ä–∞–∑—É)
cursor.execute("""
    SELECT content, embedding <-> %s AS distance
    FROM paragraphs
    WHERE tags @> ARRAY[%s]
    ORDER BY distance
    LIMIT 10
""", (query_vector.tolist(), 'ecosystem_risk'))
```

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (FAISS):
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –æ–±—ä–µ–º–æ–≤
- ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ RAM

### –ï—Å–ª–∏ –æ–±—ä–µ–º—ã —Ä–∞—Å—Ç—É—Ç:
1. **< 10M –≤–µ–∫—Ç–æ—Ä–æ–≤**: –û—Å—Ç–∞—Ç—å—Å—è –Ω–∞ FAISS –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ pgvector
2. **10M - 100M –≤–µ–∫—Ç–æ—Ä–æ–≤**: pgvector (–ø—Ä–æ—â–µ, SQL, ACID)
3. **> 100M –≤–µ–∫—Ç–æ—Ä–æ–≤**: Qdrant (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å)

### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
```
PostgreSQL (pgvector) –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö + –≤–µ–∫—Ç–æ—Ä–æ–≤
    +
Qdrant –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π (> 100M)
```

## üìù –í—ã–≤–æ–¥—ã

1. **FAISS** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ –ø–∞–º—è—Ç–∏, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –ë–î
2. **pgvector** - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL, –≤—Å–µ –≤ –æ–¥–Ω–æ–π –ë–î, –ø—Ä–æ—â–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
3. **Qdrant** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

**–î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:**
- –ï—Å–ª–∏ –æ–±—ä–µ–º—ã –Ω–µ–±–æ–ª—å—à–∏–µ (< 10M) - –º–æ–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ FAISS
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ SQL - –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ pgvector
- –ï—Å–ª–∏ –æ–±—ä–µ–º—ã —Ä–∞—Å—Ç—É—Ç (> 100M) - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å Qdrant

