# Changelog


## [0.4.3] - 2025-12-30

### Added
- **Zero-config поиск**: Все технические параметры (Hybrid Search, reranking) работают оптимально по умолчанию
- **Управление классификацией**: Пользовательский интерфейс для управления тегами классификации
  - Просмотр всех тегов с статистикой использования
  - Создание новых тегов
  - Активация/деактивация тегов
  - Анализ тегов через LLM для предложения улучшений
  - Группировка тегов по категориям
- **Просмотр схемы данных**: Компонент для просмотра схемы Weaviate
  - Отображение всех свойств коллекции
  - Информация о включенном AutoSchema
  - Группировка свойств по типам данных
  - Понятные названия типов данных
- **Страница управления классификацией**: `/classification` - централизованное место для управления классификацией и схемой
- **API endpoint `/api/storage/schema`**: Получение информации о схеме данных

### Fixed
- **Weaviate unit tests**: Исправлены все 6 падающих unit-тестов для WeaviateStorage
  - Исправлены патчи для правильного мока WEAVIATE_URL
  - Добавлено поле organisms в _paragraph_to_weaviate_object
  - Реализована поддержка index в _create_paragraph_id
  - Исправлено тестирование _create_embedding с кешированием
- **Пользовательские фильтры**: Фильтры по типу контента (риски, уязвимости, решения) вместо технических тегов
- **Фильтры по времени**: Быстрые фильтры "Сегодня", "Неделя", "Месяц", "Все время"
- **Фильтр по локации**: Поиск по географическому расположению
- **Сортировка результатов**: По релевантности или по времени (новые сначала)
- **Визуальные индикаторы**: Цветные бейджи для типов контента (риски, уязвимости, решения)
- **Активные фильтры**: Отображение примененных фильтров в результатах поиска
- **Улучшенный UI**: Понятный интерфейс без технических деталей для обычных пользователей
- **Hybrid Search**: Комбинация векторного поиска и BM25 для улучшения точности на 20-30%
- **Cross-Encoder Reranking**: Двухэтапный поиск с переранжированием для критических запросов (+10-15% точности)
- **Расширенная фильтрация**: Поддержка OR, NOT фильтров и диапазонов (timestamp, числовые значения)
- **Кеширование эмбеддингов**: LRU кеш для ускорения повторяющихся запросов (10-50x ускорение)
- **WEAVIATE_USE_HYBRID_SEARCH**: Включен по умолчанию для автоматического использования Hybrid Search
- **WEAVIATE_HYBRID_ALPHA**: Настройка баланса между BM25 и векторным поиском (по умолчанию: 0.5)
- **WEAVIATE_USE_RERANKING**: Опциональное включение Cross-Encoder Reranking (по умолчанию: false)
- **WEAVIATE_RERANK_LIMIT**: Количество кандидатов для reranking (по умолчанию: 50)
- **WEAVIATE_EMBEDDING_CACHE_SIZE**: Размер кеша эмбеддингов (по умолчанию: 1000)
- **Метод _build_filters**: Централизованное построение фильтров с поддержкой расширенных операций
- **Метод search_with_reranking**: Отдельный метод для поиска с переранжированием
- **Документация продвинутых возможностей**: Полное описание всех новых фич с примерами использования

### Improved
- **Точность поиска**: Улучшена на 20-30% благодаря Hybrid Search
- **Производительность**: Кеширование эмбеддингов ускоряет повторяющиеся запросы
- **Гибкость фильтрации**: Поддержка сложных логических условий (OR, NOT, диапазоны)

### Changed
- **search_similar**: Теперь использует Hybrid Search по умолчанию (если включено)
- **search_similar_paragraphs**: Поддерживает опциональный reranking для улучшения точности

## [0.4.2] - 2025-12-30

### Added
- **Detailed gRPC logging**: Добавлено подробное логирование процесса gRPC подключения к Weaviate
- **Auto gRPC URL derivation**: Автоматическое вычисление gRPC URL из HTTP URL если не задан явно
- **Playwright browser installation**: Улучшена установка браузеров Playwright в Docker образах
- **Weaviate HNSW optimization**: Оптимизированные настройки HNSW индекса (ef_construction=256, max_connections=32, dynamic ef)
- **Batch size optimization**: Увеличен batch_size до 500 для лучшей производительности импорта
- **Configurable Weaviate settings**: Переменные окружения для настройки HNSW параметров, batch size, памяти и lazy loading
- **Built-in Weaviate AutoSchema**: Переход на встроенную AutoSchema Weaviate для органической эволюции симбиосети
- **Adaptive schema for symbiocore**: Схема автоматически адаптируется к новым симбиотическим связям и паттернам
- **WEAVIATE_USE_BUILTIN_AUTOSCHEMA**: Включена по умолчанию для поддержки динамической структуры данных
- **Schema code cleanup**: Удалены устаревшие функции ручного управления схемой, оставлены заглушки для совместимости
- **Unit tests update**: Обновлены unit тесты для работы с новой архитектурой AutoSchema
- **Hybrid classification**: Гибридная классификация параграфов с использованием Weaviate + LLM для улучшения точности
- **NER integration**: Полная интеграция Named Entity Recognition - автоматическое извлечение организмов, локаций и экосистем из текста
- **Entity storage**: Новое поле organisms в Paragraph для хранения извлеченных сущностей
- **gRPC как основной протокол**: WEAVIATE_PREFER_GRPC настройка для использования gRPC по умолчанию
- **Оптимизация подключения**: gRPC режим активирован для максимальной производительности векторных операций
- **Развертывание Weaviate в Dokku**: Инструкции по развертыванию Weaviate как отдельного приложения
- **Подключение приложений к Weaviate**: Настройка переменных окружения для внутреннего сетевого доступа

### Fixed
- **Weaviate gRPC connection**: Исправлена логика подключения к Weaviate по gRPC - теперь достаточно задать только `WEAVIATE_GRPC_URL`
- **Storage selection logic**: Упрощена логика выбора хранилища, убрана зависимость от `WEAVIATE_URL` для gRPC подключения
- **Dockerfile Playwright**: Исправлена установка Playwright браузеров в Docker, добавлена установка в runtime стадии
- **Burger menu condition**: Исправлено условие включения аналитической панели - теперь активируется при >2 сообщениях вместо >=2
- **Dockerfile DNS issues**: Исправлены проблемы с DNS разрешением во время сборки образов
- **Stage references**: Исправлены неправильные ссылки на stages в COPY --from директивах
- **Multi-stage build**: Улучшена стабильность сборки multi-stage Docker образов
- **Weaviate gRPC URL**: Исправлено использование WEAVIATE_GRPC_URL вместо жестко прописанного grpc_port=50051
- **Парсинг gRPC параметров**: Добавлен правильный парсинг grpc_host и grpc_port из WEAVIATE_GRPC_URL
- **Проверка и установка пакетов в persistent venv**: Добавлена логика проверки наличия granian в persistent venv и переустановка при необходимости
- **Отладка запуска приложения**: Добавлены проверки активации venv и наличия granian
- **Отсутствующий venv в production контейнере**: Добавлено копирование `/opt/venv` из python-deps stage
- **Восстановлен start.sh**: Вернут startup script с логикой создания symlink для persistent venv
- **Исправлен CMD**: Возвращен запуск через start.sh вместо прямого uv run
- **UID пользователя appuser**: Возвращен к стандартному Dokku UID 1000
  - Dockerfile изменен с UID 999 обратно на 1000
  - scripts/setup_dokku_cache.sh использует chown 1000:1000
  - DOKKU_APP_USER_ID установлен на 1000

## [0.4.1] - 2025-12-29

### Fixed
- **Права доступа к persistent storage**: UID 999 не имел доступа к файлам
  - Добавлена подробная отладка создания symlink в start.sh
  - Исправлены права на /var/lib/dokku/data/storage/shared

## [0.4.0] - 2025-12-29

### Fixed
- **Исправлено создание venv symlink**: Решена проблема с правами доступа
  - Dockerfile больше не создает symlink заранее (конфликт с persistent storage)
  - start.sh удаляет существующий /opt/venv перед созданием нового symlink
  - Обеспечена правильная работа с смонтированным venv

## [0.3.9] - 2025-12-29

### Fixed
- **Исправлены пути в Dockerfile**: Все COPY команды используют /app/.cache
  - Исправлена переменная PLAYWRIGHT_BROWSERS_PATH в node-deps stage
  - Все COPY --from команд указывают на правильные пути
  - Решена ошибка "failed to calculate checksum" при сборке

## [0.3.8] - 2025-12-29

### Fixed
- **Изменен путь persistent storage**: С /root/.cache на /app/.cache
  - Решена проблема конфликта с Docker сборкой
  - Playwright браузеры копируются в /app/.cache/ms-playwright
  - start.sh и setup_dokku_cache.sh обновлены соответственно

## [0.3.7] - 2025-12-29

### Fixed
- **Отладка прав доступа**: Добавлена диагностика в start.sh
  - Вывод информации о текущем пользователе и правах
  - Попытка ручного создания директории /root/.cache/uv
  - Помощь в диагностике проблемы os error 13

## [0.3.6] - 2025-12-29

### Fixed
- **Dockerfile UID исправлен**: Возвращен UID 999 для appuser
  - Dockerfile был случайно возвращен к UID 1000
  - Теперь использует UID 999 для совместимости с zabbix
  - scripts/setup_dokku_cache.sh использует chown zabbix:zabbix

## [0.3.5] - 2025-12-29

### Fixed
- **Persistent storage права доступа**: Решена проблема os error 13 (Permission denied)
  - Директории кеша создаются заранее на сервере с UID 999
  - Исправлены права доступа на /var/lib/dokku/data/storage/shared
  - Убрана ненужная отладка из start.sh

## [0.2.7] - 2025-12-29

### Fixed
- **Исправлена проблема с правами доступа к кешам в Dokku**: Все кеши остаются в `/root/.cache`
  - Обновлен существующий start.sh скрипт с логикой исправления прав доступа
  - Автоматическая установка владельца текущего пользователя на `/root/.cache`
  - Dockerfile копирует start.sh вместо генерации
  - Убрана дублирующая сборка frontend из start.sh (DRY принцип)

## [0.2.6] - 2025-12-29

### Added
- **Функционал генерации саммари диалога**: Кнопка для создания структурированного summary
  - JSON-based LLM промпт для генерации сводки
  - API endpoint `/api/detect/summary`
  - Кнопка с loading состоянием и иконкой документа
  - Отображение результатов в чате

### Improved
- **Управление видимостью аналитической панели**: Кнопка меню disabled пока нет хотя бы 2 сообщений
  - Проверка количества узлов в дереве диалога
  - Disabled состояние с информативным tooltip
  - Переименование функций для лучшей ясности (conversationTree → analytics panel)

## [0.2.5] - 2025-12-29

## [0.2.4] - 2025-12-29

### Improved
- **UX для ошибок детекции**: Ошибки 500 теперь отображаются анимацией кнопки вместо сообщений в чате
  - Временная анимация "errorShake" для кнопки при ошибке
  - Красная подсветка иконки с эффектом пульсации
  - Автоматический сброс состояния ошибки через 2 секунды

## [0.2.2] - 2025-12-29

### Added
- **Frontend интеграция Weaviate**: Создан простой клиент для работы с Weaviate из SolidJS
  - Zod схемы для runtime валидации данных
  - SolidJS хуки `createParagraphSearch` и `createParagraphLoader`
  - Компонент `ParagraphSearch` для демонстрации поиска параграфов
  - API endpoints `/api/search` (GET) и `/api/documents/{id}/paragraphs/{id}` (GET)

## [0.2.1] - 2025-12-29

### Changed
- **UI/UX улучшения в чате**:
  - Перемещены кнопки анализа текста (организмы, экосистемы, среда, комплексный анализ) из основного интерфейса в правый сайдбар
  - Убрана секция "Связанные знания" из заголовка панели, кнопки анализа теперь интегрированы в RelatedKnowledge компонент
  - Улучшена организация элементов в сайдбаре с логической группировкой функциональности

### Fixed
- **Исправлена несовместимость зависимостей Python**: Зафиксированы совместимые версии protobuf и grpcio для корректной работы Weaviate клиента
### Performance
- **Оптимизирован Dockerfile для минимального размера образа**:
  - Переработан на multi-stage builds с использованием slim образов (python:3.11-slim, node:18-slim)
  - Добавлен `.dockerignore` для исключения ненужных файлов из контекста сборки
  - Удаление кешей пакетов после установки (`uv cache clean`, `npm cache clean`)
  - Использование `--no-install-recommends` для apt-get
  - Добавлен non-root пользователь для безопасности
  - Health check для мониторинга контейнера
- **Оптимизировано кеширование Python пакетов в Dokku**:
  - Переработан Dockerfile с multi-stage builds для лучшего layer caching
  - Добавлена настройка persistent storage для всех кешей: pip, npm, Playwright, UV, Cargo
  - Переменные окружения для кеширования установлены во всех Docker стадиях
  - Добавлен Docker build cache mount для pip (`--mount=type=cache`)
  - **UV пакетный менеджер**: Заменен pip на uv для более быстрой установки пакетов
  - Создан скрипт `scripts/setup_dokku_cache.sh` с проверкой существования приложения
  - **Shared Python venv**: Создан общий virtual environment (~8GB) в `/root/.cache/venv` для всех Python проектов
  - Dockerfile автоматически использует shared venv если он доступен
  - Скрипт `scripts/apply_shared_venv.sh` для массового применения shared venv ко всем приложениям

### Removed
- **YAGNI cleanup**: Удалены неиспользуемые компоненты редактора узлов:
  - Компоненты: `EditorSidebars`, `NodeEditor`, `NodeToolbar`
  - Страница: `NodeEditorPage.tsx` с роутом `/node-editor`
  - Соответствующие CSS файлы
- Удален неиспользуемый DialogSidebar компонент из NodeEditorPage

## [0.2.0] - 2025-12-29

### Added
- **Векторное хранилище и абстракции для FAISS и Weaviate**:
  - Реализован `WeaviateStorage` класс для персистентного хранения векторов в Weaviate v4
  - Добавлена фабрика `create_database_manager` для автоматического выбора SQLite/PostgreSQL
  - Создан паттерн абстракций для векторных хранилищ с единым интерфейсом
  - Реализована интеграция с Weaviate через классы данных и фильтры
  - Добавлена поддержка метаданных и полнотекстового поиска в Weaviate
  - Внедрена система проверки дискового пространства для Weaviate тестов

- **Архитектурные улучшения и типизация**:
  - Полная типизация всех модулей с поддержкой mypy
  - Исправлены 7 критических ошибок типизации в хранилищах и сервисах
  - Добавлены Union типы для совместимости FAISS и Weaviate интерфейсов
  - Внедрены проверки на None и обработка исключений в векторных операциях
  - Улучшена обработка Promise в SolidJS компонентах с createResource

### Changed
- **Рефакторинг архитектуры хранения**:
  - Единый интерфейс для FAISSStorage и WeaviateStorage
  - Автоматическое переключение между хранилищами через WEAVIATE_URL
  - Улучшенная обработка ошибок в векторных операциях
  - Оптимизирована загрузка моделей эмбеддингов с кешированием

### Fixed
- **Исправления типизации и стабильности**:
  - Решены проблемы с типами в `simbiotic_graph.py` (конвертация параметров)
  - Исправлена обработка None значений в `weaviate_storage.py`
  - Защищены операции с document_ids от несоответствия типов
  - Добавлена обработка исключений в векторных преобразованиях
  - Пропуск Weaviate тестов при недостатке дискового пространства

## [0.1.2] - 2025-12-26

### Added
- **Агентная система AgREE для дополнения графа знаний**:
  - Реализован модуль `api/kb/agree_agent.py` с итеративным поиском и multi-step reasoning
  - Создан сервис `api/storage/symbiotic_service.py` для работы с симбиотическими связями
  - Добавлен промпт `api/prompts/agree_agent.txt` для агентного reasoning
  - Добавлен endpoint `/api/kb/agree/complete` для автоматического дополнения графа знаний
  - Агент автоматически находит информацию о новых организмах и создает триплеты (организм → связь → организм/экосистема)
  - Реализован итеративный поиск с оценкой достаточности информации
  - Интеграция с существующими сервисами (detect, classify, web_search)

### Changed
- Улучшена структура работы с симбиотическими связями через отдельный сервис

## [0.1.1] - 2025-12-25

### Added
- **Viewport с zoom и pan в NodeEditor**:
  - Реализован zoom колесиком мыши (диапазон 0.1x - 3x)
  - Реализован pan правой кнопкой мыши для перемещения viewport
  - Трансформация применяется к контейнеру узлов с учетом масштаба
  - Позиции портов и связей корректно рассчитываются с учетом viewport

- **Функции удаления в NodeEditorPage**:
  - Добавлена функция `handleDeleteNode` для удаления узлов и связанных связей
  - Добавлена функция `handleDeleteConnection` для удаления связей
  - Добавлены кнопки в палитре для удаления изолированных узлов и всех связей
  - Реализованы горячие клавиши (Ctrl+Delete) для удаления изолированных узлов

### Changed
- **Улучшена обработка событий мыши**:
  - Обработка движения мыши учитывает viewport трансформацию
  - Перетаскивание узлов работает корректно при любом масштабе
  - Создание связей учитывает позицию viewport

### Fixed
- Исправлены ошибки линтера:
  - Удален неиспользуемый импорт `Show` из `NodeEditor.tsx`
  - Исправлены типы для `NodePort` и `DragEvent` в `NodeEditorPage.tsx`
  - Заменены `forEach` на `for...of` для избежания предупреждений
  - Исправлен синтаксис `transform-origin` в стилях SolidJS

## [0.1.0] - 2025-12-25

### Added
- **Миграция на единое хранилище БД**:
  - Все узлы знаний теперь хранятся в БД (SQLite/PostgreSQL) через `DatabaseNodeRepository`
  - Создан скрипт миграции `api/kb/migrate_json_to_db.py` для переноса данных из JSON в БД
  - Единая точка доступа к данным через `app.state.kb_service`

### Changed
- **Унификация хранилища данных**:
  - `api/kb/routes.py` теперь использует `app.state.kb_service` (БД) вместо `JSONNodeRepository`
  - `api/bot/handler.py` получает `kb_service` через конструктор `MessageProcessor`
  - `api/bot/main.py` передает `kb_service` в `BotManager` при инициализации
  - `api/kb/user_metrics.py` принимает `kb_service` через конструктор
  - Все компоненты используют единый `DatabaseNodeRepository` вместо JSON файлов
- **Архитектура**:
  - Удалено дублирование хранилищ (JSON и БД)
  - Все данные теперь в единой БД с поддержкой транзакций и индексов
  - Улучшена масштабируемость и производительность

### Removed
- **Устаревшее хранилище**:
  - `JSONNodeRepository` больше не используется в основном коде
  - Файл `data/knowledge_base.json` больше не используется для записи (только для миграции)

### Migration
- Для миграции существующих данных из JSON в БД выполните:
  ```bash
  python -m api.kb.migrate_json_to_db
  ```

## [0.0.43]

### Changed
- **Логирование бота: установлен уровень DEBUG**:
  - Изменен уровень логирования с `INFO` на `DEBUG` в `api/logger.py`
  - Теперь все логи бота (DEBUG, INFO, WARNING, ERROR) выводятся в консоль
  - Улучшена диагностика работы Telegram бота
- **Упрощение обработки изображений**:
  - Удалена загрузка локальной модели SmolVLM из `api/detect/image_processor.py`
  - Убраны импорты `transformers` и `torch` из модуля обработки изображений
  - Теперь используется только vision модели (gpt-4o, gemini-2.0-flash и т.д.)
  - При недоступности vision моделей используется LLM fallback
  - Код стал проще и не требует локальных моделей для анализа изображений

### Removed
- **Зависимости: удалены torch и transformers из requirements.txt**:
  - `torch>=2.0.0` и `transformers>=4.30.0` удалены из явных зависимостей
  - Эти библиотеки устанавливаются автоматически через `sentence-transformers` при необходимости
  - Уменьшен размер файла зависимостей и упрощено управление версиями

## [0.0.42]

### Added
- **Поддержка PostgreSQL**:
  - Создан `PostgreSQLManager` для работы с PostgreSQL базой данных
  - Реализован базовый абстрактный класс `DatabaseManagerBase` для унификации интерфейса
  - Добавлена фабрика `create_database_manager()` для автоматического выбора БД по `DATABASE_URL`
  - Поддержка автоматической конвертации SQL-параметров (`?` → `%s` для PostgreSQL)
  - Разбор SQL-скриптов для PostgreSQL (разбиение на отдельные запросы)
  - Добавлен `psycopg2-binary` в `requirements.txt`
  - Документация: создан `docs/vector_search_comparison.md` с сравнением FAISS, pgvector и Qdrant

### Changed
- **Рефакторинг репозитория узлов знаний**:
  - Переименован `SQLiteNodeRepository` → `DatabaseNodeRepository` (работает с SQLite и PostgreSQL)
  - Файл переименован: `sqlite_repository.py` → `nodes_repository.py`
  - Обновлена документация: репозиторий теперь работает с обеими БД через `DatabaseManager`
  - Обновлены все импорты в `api/main.py`, `api/chat/routes.py`, `api/storage/__init__.py`

### Fixed
- **Исправление ошибок выдачи LLM**:
  - Функция `clean_llm_response()` теперь фильтрует промо-сообщения и технические ошибки авторизации из ответов LLM
  - Удаляются сообщения вида "Want best roleplay experience? https://llmplayground.net"
  - Фильтруются технические сообщения об ошибках авторизации моделей (например, "Authorization error for model gemini-2.0-flash: No Yupp accounts configured")
  - Удаляются нежелательные префиксы из ответов ("Краткий ответ на основе контекста:", "Ответ:", и т.д.)

## [0.0.41]

### Fixed
- **Dockerfile: возвращена установка Playwright для продакшена**:
  - Playwright Chromium теперь устанавливается в прод-образ, так как требуется для `crawl4ai` (веб-краулинг в продакшене)
  - Устанавливается только Chromium (`npx playwright install --with-deps chromium`) для минимизации размера образа
  - Обновлена документация `docs/dockerfile_cache_setup.md` с уточнением, что Playwright нужен для продакшена
- **Зависимости: обновлён duckduckgo-search → ddgs**:
  - Заменён устаревший пакет `duckduckgo-search` на `ddgs` (рекомендуется разработчиками)
  - Обновлён импорт в `api/detect/web_search.py` с `duckduckgo_search` на `ddgs`

## [0.0.40]

### Changed
- **Dockerfile: Playwright отделён от прод-деплоя** (откат в 0.0.41):
  - Основной Docker-образ больше не выполняет `npx playwright install --with-deps` и не тянет Playwright-браузеры на сервер.
  - Кеширование Playwright (`/root/.cache/ms-playwright`, `PLAYWRIGHT_BROWSERS_PATH`) помечено в документации как опция для dev/CI образов, а не для продового деплоя.

## [0.0.39]

### Fixed
- **Chat LLM error handling and retries**:
  - LLM provider errors in `/api/chat/message` no longer produce user-visible error text in chat responses; details are logged only to the server console
  - Frontend chat tree updates in `InterviewPage` no longer perform client-side retry loops; all retry logic remains on the backend LLM/model layer
  - Documentation `docs/llm.md` updated to clarify that retries are backend-only and LLM errors never leak into the chat UI

## [0.0.38]

### Fixed
- **LLM: улучшена обработка ошибок провайдера airforce**:
  - Сообщения вида `The model does not exist in https://api.airforce` теперь явно распознаются как недоступность конкретной модели
  - Неудачная модель удаляется из ротации, запрос автоматически пробует другие модели без протечки низкоуровневого текста ошибки к пользователю
  - Документация `docs/llm.md` обновлена для описания поведения на уровне моделей и отдельных запросов

## [0.0.37]

### Fixed
- **Исправлена ошибка потоков SQLite при сохранении параграфов чата**:
  - Подключение в `DatabaseManager` теперь создаётся с `check_same_thread=False`
  - Устранена ошибка `SQLite objects created in a thread can only be used in that same thread` при работе uv/granian

## [0.0.36]

### Changed
- **Dockerfile кеширует ms-playwright**:
  - Добавлен каталог `/root/.cache/ms-playwright` для кеша браузеров Playwright
  - Установлена переменная окружения `PLAYWRIGHT_BROWSERS_PATH` для использования кеша
  - В stage `install` теперь выполняется `npx playwright install --with-deps` c использованием кешей
- **Документация**:
  - Обновлен `docs/dockerfile_cache_setup.md` с описанием кеша `ms-playwright`

## [0.0.35]

### Changed
- **Обновлен Dockerfile для использования общего кеша пакетов**:
  - Созданы директории для кешей Python (pip, uv, poetry), Rust (cargo), Node.js (npm, yarn, pnpm)
  - Добавлены переменные окружения для путей кешей (PIP_CACHE_DIR, NPM_CONFIG_CACHE, CARGO_HOME и т.д.)
  - Убран флаг `--no-cache-dir` из pip install для использования кеша
  - Добавлен флаг `--cache` для npm ci
  - Кеши будут использоваться при монтировании persistent storage через Dokku
- **Документация**:
  - Создан `docs/dockerfile_cache_setup.md` с объяснением настройки кешей в Dockerfile
  - Обновлены скрипты настройки Dokku для корректной работы с Dockerfile

## [0.0.34]

### Added
- **API для детекторов** (`api/detect/routes.py`):
  - `/api/detect/intent` - определение намерения и рекомендация детекторов
  - `/api/detect/organisms` - обнаружение организмов в тексте
  - `/api/detect/ecosystems` - обнаружение экосистем в тексте
  - `/api/detect/environment` - извлечение данных об окружающей среде
  - `/api/detect/all` - вызов всех детекторов параллельно
  - `/api/detect/smart` - умный вызов детекторов на основе intent detection
  - Интеграция с intent_detector для автоматического определения нужных детекторов
  - Параллельный вызов детекторов для оптимизации производительности
- **Документация архитектуры детекторов** (`docs/detectors_architecture.md`):
  - Блок-схема текущей архитектуры
  - Описание всех детекторов и их использования
  - Предлагаемая архитектура с API endpoints
  - Связь между intent_detector и детекторами

### Changed
- **Обновлен main.py**:
  - Добавлен роутер детекторов (`routerDetect`)
  - Детекторы теперь доступны через REST API

## [0.0.33]

### Added
- **Тесты для новой функциональности**:
  - Создан `tests/test_environment_quality.py` с полным покрытием тестами детектора окружающей среды
  - Создан `tests/test_image_processor.py` с тестами обработки изображений и извлечения environment данных
  - Тесты покрывают все основные сценарии:
    * Базовое извлечение данных об окружающей среде
    * Работа с данными локализации
    * Обнаружение загрязненной среды
    * Обработка неопределенных данных
    * Обработка ошибок и невалидного JSON
    * Извлечение факторов для симбиозов
    * Интеграция в ImageProcessor

## [0.0.32]

### Added
- **Детектор состояния окружающей среды и климатических условий**:
  - Новый модуль `environment_quality.py` для извлечения данных об окружающей среде
  - Промпт `environment_quality.txt` для анализа климата и состояния среды
  - Извлечение климатических условий:
    * Температура, влажность, осадки, ветер, сезон, освещенность
  - Оценка состояния окружающей среды:
    * Качество воздуха, воды, почвы
    * Уровень загрязнения и антропогенного воздействия
  - Факторы для поиска симбиозов:
    * Тип биома, доступность ресурсов (вода, питательные вещества, свет, укрытия)
    * Угрозы для экосистемы, потенциал для улучшения
    * Благоприятные условия для симбиозов
  - Общая оценка состояния экосистемы:
    * Здоровье, биоразнообразие, стабильность
  - Интеграция в `ImageProcessor` - данные об окружающей среде извлекаются из описаний изображений

### Changed
- **Обновлены промпты анализа изображений**:
  - Добавлены инструкции по описанию климатических условий и состояния окружающей среды
  - Добавлены разделы о полезных данных для поиска симбиозов
  - Все три промпта (vision, smolVM, LLM fallback) обновлены
- **Обновлен ImageProcessor**:
  - Добавлен метод `_extract_environment_from_description()` для извлечения данных об окружающей среде
  - Результат обработки изображения теперь включает поле `environment` с полной информацией

## [0.0.31]

### Changed
- **Изоляция промптов в отдельные файлы**:
  - Промпты для анализа изображений вынесены в отдельные файлы:
    * `image_analysis.txt` - для vision, smolVM модели и LLM fallback (с плейсхолдерами для метаданных)
  - Обновлен `ImageProcessor` для загрузки промптов из файлов
  - Добавлен метод `_load_prompt()` для загрузки промптов с fallback на упрощенную версию

## [0.0.30]

### Added
- **Улучшенное распознавание организмов по фото**:
  - Расширены промпты для vision моделей с фокусом на детальное распознавание растений, насекомых и птиц
  - Добавлена категоризация организмов (дерево, кустарник, насекомое, птица и т.д.)
  - Улучшено извлечение научных названий и характерных признаков
  - Vision модели теперь получают детальные инструкции по распознаванию:
    * Растения: вид, род, семейство, листья, цветы, плоды, форма роста
    * Насекомые: вид, отряд, семейство, размер, окраска, форма тела, крылья, усики
    * Птицы: вид, род, семейство, размер, окраска оперения, форма клюва, лап

### Changed
- **Обновлен промпт organism_detector.txt**:
  - Добавлена категоризация организмов (category поле)
  - Расширены инструкции для правильного определения категорий растений, насекомых и птиц
  - Добавлены примеры с категориями в формат ответа
- **Обновлен ImageProcessor**:
  - Все три метода анализа изображений (vision, smolVM, LLM fallback) используют улучшенные промпты
  - Промпты фокусируются на детальном распознавании организмов с указанием характерных признаков
- **Обновлен detect_organisms**:
  - Добавлено поле `category` в результат для лучшей категоризации организмов
  - Поддержка категорий: дерево, кустарник, трава, насекомое, птица, млекопитающее и т.д.

## [0.0.29]

### Added
- **Теглайн "Планетарный стетоскоп"**:
  - Добавлен теглайн на главную страницу (HomePage) под заголовком
  - Добавлен в Header (отображается при расширении сайдбара)
  - Добавлен в Footer
  - Обновлен title страницы в index.html
  - Добавлены переводы в intl.json (русский и английский)

### Changed
- **Обновлен дизайн главной страницы**:
  - Добавлен стиль для heroTagline (курсив, серый цвет, меньший размер)
  - Теглайн отображается между заголовком и подзаголовком

## [0.0.28]

### Added
- **Обработка изображений**:
  - Модуль `api/process/image_processor.py` для обработки изображений
  - Поддержка изображений с микроскопа (микробиология, клетки, ткани)
  - Поддержка обычных фотографий (экосистемы, организмы, ландшафты)
  - Поддержка спутниковых снимков NASA (ландшафты, экосистемы, изменения климата)
  - Автоматическое определение типа изображения по метаданным и имени файла
  - Анализ изображений через LLM для получения описаний
  - Автоматическое обнаружение организмов и экосистем из описания изображения
  - Извлечение локализации из описания
  - Сохранение изображений в base64 в метаданных документов
- **Обновлена главная страница**:
  - Добавлены карточки с новыми функциями: анализ изображений, умная классификация, обнаружение организмов и экосистем, векторный поиск, холистическая модель
  - Отражены ключевые возможности системы из версий 0.11+

### Changed
- **Расширен эндпоинт загрузки файлов** (`/api/chat/upload-file`):
  - Автоматическое определение типа файла (текст или изображение)
  - Обработка изображений через `ImageProcessor`
  - Сохранение метаданных изображений (тип, размеры, формат, base64)
  - Интеграция с обнаружением организмов и экосистем для изображений

### Technical Details
- Добавлена зависимость `Pillow>=10.0.0` для обработки изображений
- Изображения анализируются через LLM с промптами, специфичными для типа изображения
- Обнаруженные организмы и экосистемы сохраняются в метаданных узла знания

## [0.0.27]

### Added
- **Полное покрытие тестами нового функционала**:
  - `test_ecosystem_scaler.py` - 8 тестов для детектора экосистем
  - `test_ecosystem_service.py` - 8 тестов для сервиса экосистем
  - `test_organism_detector.py` - 6 тестов для детектора организмов
  - `test_organism_classifier.py` - 7 тестов для классификатора организмов
  - `test_organism_service.py` - 8 тестов для сервиса организмов
  - Расширены тесты `test_storage_schema.py` для новых таблиц (ecosystems, organisms, organism_ecosystems, symbiotic_relationships)
  - Всего добавлено 37 новых тестов, покрывающих весь новый функционал

### Fixed
- Исправлена синтаксическая ошибка `async async def` в `organism_detector.py`
- Исправлено форматирование промптов с фигурными скобками в JSON примерах
- Добавлен `DocumentType.DOCUMENT` в enum для поддержки всех типов документов
- Исправлены тесты для работы с FOREIGN KEY constraints (создание тестовых параграфов)

## [0.0.26]

### Changed
- **Расширена система масштабов экосистем**:
  - Добавлено 12 уровней масштаба вместо 5
  - Новые уровни: molecular, cellular, tissue, organ, organism, micro_habitat, habitat, landscape, regional, continental, global, planetary
  - Более точная классификация экосистем для качественного датасета
  - Обновлены промпты и документация с описанием всех уровней
- **Обновлены значения по умолчанию**:
  - `scale` по умолчанию изменен с "local" на "habitat" (среда обитания)
  - Более точное соответствие реальным экосистемам

## [0.0.25]

### Changed
- **Детектор экосистем интегрирован с детектором локализации**:
  - `detect_ecosystems()` теперь принимает опциональный параметр `location_data`
  - Автоматически использует данные локализации из `extract_location_and_time`
  - Использует локализацию для более точного определения экосистем
  - Добавлена временная ссылка в результаты обнаружения экосистем
- **Обновлен промпт `ecosystem_scaler.txt`**:
  - Учитывает извлеченную локализацию из текста
  - Использует данные локализации для более точного определения экосистем
- **Интеграция в процесс классификации параграфов**:
  - Экосистемы обнаруживаются после извлечения локализации
  - Данные локализации передаются в детектор экосистем
  - Результаты сохраняются в метаданных параграфа

## [0.0.24]

### Added
- **Холистическая модель организмов и экосистем**:
  - Таблица `ecosystems` для хранения экосистем как организмов (метаболизм, гомеостаз)
  - Таблица `organism_ecosystems` для связи организм-экосистема (многие ко многим)
  - Поле `internal_ecosystem_id` в `organisms` для микробиома (организм = маленькая экосистема)
  - Таблица `symbiotic_relationships` для симбиотических связей на разных уровнях
  - Поддержка вложенных экосистем (экосистема внутри экосистемы)
- **Детектор экосистем** (`api/detect/ecosystem_scaler.py`):
  - Обнаруживает экосистемы в тексте через LLM
  - Определяет масштаб (micro, local, regional, global, planetary)
  - Выявляет вложенные структуры
  - Промпт в `api/prompts/ecosystem_scaler.txt`
- **Сервис для работы с экосистемами** (`api/storage/ecosystem_service.py`):
  - Создание и управление экосистемами
  - Связывание организмов с экосистемами
  - Получение организмов в экосистеме и экосистем для организма
- **Обновленные промпты**:
  - `organism_detector.txt` - учитывает холизм (организм = экосистема)
  - `organism_classifier.txt` - учитывает внутренние экосистемы (микробиом)

### Changed
- **Схема БД расширена** для поддержки холизма:
  - Организм может иметь внутреннюю экосистему (микробиом)
  - Организм может быть частью нескольких экосистем одновременно
  - Экосистемы могут быть вложенными
  - Симбиотические связи на разных уровнях (intra_organism, inter_organism, ecosystem)

## [0.0.23]

### Added
- **Детектор организмов-участников экосистемы** (`api/detect/organism_detector.py`):
  - Обнаруживает организмы (растения, животные, грибы, бактерии) в тексте через LLM
  - Извлекает название, научное название, тип и контекст упоминания
  - Промпт вынесен в `api/prompts/organism_detector.txt`
- **Классификатор организмов по биологической роли** (`api/classify/organism_classifier.py`):
  - Классифицирует организмы по трофическим уровням (продуценты, консументы, редуценты)
  - Определяет биохимические роли (фотосинтез, разложение, фиксация азота, симбиоз и т.д.)
  - Описывает метаболические пути обмена веществ
  - Промпт вынесен в `api/prompts/organism_classifier.txt`
- **Сервис для сохранения организмов** (`api/storage/organism_service.py`):
  - Сохранение организмов в таблицу `organisms` в БД
  - Получение организмов по параграфу или трофическому уровню
- **Таблица organisms в схеме БД**:
  - Хранение информации об организмах с трофическими уровнями
  - Биохимические роли и метаболические пути в JSON формате
  - Связь с параграфами через `paragraph_id`
- **Интеграция в процесс классификации параграфов**:
  - Автоматическое обнаружение и классификация организмов при сохранении параграфов
  - Сохранение организмов в БД и метаданных параграфа

## [0.0.22]

### Added
- **Система автоматического управления тегами через LLM**:
  - Таблица `tags` для хранения тегов с метаданными (описание, категория, примеры, счетчик использования)
  - `TagService` для управления тегами: создание, обновление, анализ через LLM
  - Автоматическое предложение тегов для параграфов через LLM при классификации
  - Автоматический анализ параграфов и предложение новых тегов/улучшений
  - Инициализация тегов по умолчанию при первом запуске
  - API эндпоинты для управления тегами (`/api/storage/tags`)
- **Интеграция LLM классификации**:
  - `_classify_paragraph()` теперь использует LLM для предложения тегов из актуального списка
  - Автоматическое обновление счетчиков использования тегов
  - Сохранение примеров использования тегов для обучения LLM

### Changed
- **Улучшена классификация параграфов**:
  - Классификация теперь использует актуальный список тегов из БД
  - LLM анализирует параграф и предлагает наиболее подходящие теги
  - Поддержка множественных тегов для одного параграфа

## [0.0.21]

### Added
- **Множественные теги классификации для параграфов**:
  - Добавлено поле `tags` (JSON массив) в таблицу `paragraphs` для хранения множественных тегов
  - Параграф может одновременно иметь несколько тегов (например: `["ecosystem_vulnerability", "ecosystem_risk"]`)
  - Обновлена классификация для поддержки множественных тегов
  - Добавлена фильтрация по тегам в API векторного поиска
  - Поле `classification` сохранено для обратной совместимости
- **Новые API эндпоинты для работы с параграфами** (`/api/storage`):
  - `GET /api/storage/paragraphs` - получение параграфов из SQLite с фильтрацией
  - `POST /api/storage/search` - векторный поиск с фильтрацией по тегам и классификации
  - `GET /api/storage/dataset/export` - экспорт датасета для подготовки данных
  - `GET /api/storage/documents` - список всех документов в индексе
  - `GET /api/storage/documents/{document_id}/paragraphs` - параграфы конкретного документа

### Changed
- **Улучшен workflow векторной индексации**:
  - Исправлено дублирование создания `FAISSStorage` и `ParagraphService` в routes - теперь используются из `app.state`
  - Добавлена загрузка параграфов из SQLite в FAISS при старте приложения
  - Обновлены все эндпоинты для использования сервисов из `app.state`
- **Обновлена классификация параграфов**:
  - Метод `_classify_paragraph()` теперь поддерживает множественные теги
  - Классификатор может возвращать список тегов вместо одного значения
  - Сохранена обратная совместимость с одиночной классификацией

### Fixed
- Исправлена обработка `author_id` при сохранении параграфов (может быть `None`)
- Исправлена загрузка параграфов из SQLite с восстановлением всех полей включая теги
- Исправлено использование сервисов из `app.state` во всех эндпоинтах чата

## [0.0.20]

### Changed
- **Реорганизация структуры файлов**:
  - `api/kb/sqlite_repository.py` → `api/storage/sqlite_repository.py` (репозиторий для storage)
  - `api/kb/file_upload.py` → `api/chat/file_upload.py` (эндпоинт загрузки файлов в chat)
  - `api/kb/paragraph_service.py` → `api/storage/paragraph_service.py` (сервис для работы с параграфами - логичнее в storage, так как работает с SQLite и FAISS)
  - Обновлены все импорты в соответствии с новой структурой
  - Эндпоинт загрузки файлов: `/api/kb/upload-file` → `/api/chat/upload-file`

### Added
- **SQLite репозиторий для узлов знаний** (`api/storage/sqlite_repository.py`):
  - Реализация `NodeRepository` на основе SQLite
  - Полная замена JSON репозитория с поддержкой всех операций
  - Использует схему `schema.sql` для хранения узлов в таблице `knowledge_nodes`
  - Поддержка parent-child связей через таблицу `node_children`
- **Сервис для работы с параграфами** (`api/storage/paragraph_service.py`):
  - Парсинг текста на параграфы (по двойным переносам строк или предложениям)
  - Сохранение параграфов в таблицу `paragraphs`
  - Векторизация параграфов через FAISS
  - Сохранение векторов в таблицу `vectors`
  - Методы: `save_document_paragraphs()`, `save_node_paragraphs()`, `save_chat_message_paragraphs()`
- **Эндпоинт для загрузки файлов** (`api/chat/file_upload.py`):
  - POST `/api/chat/upload-file` - загрузка файлов с автоматическим парсингом
  - Парсит файл на параграфы, векторизует и сохраняет в БД
  - Создает документ в таблице `documents`
  - Создает узлы знаний для файла
  - Убрано ограничение в 500 символов - обрабатывается весь файл
- **Интеграция парсинга в диалоги чата**:
  - Сообщения пользователя и ответы AI парсятся на параграфы
  - Параграфы сохраняются в таблицу `paragraphs` с `document_type='chat'`
  - Векторизация для FAISS поиска
- **Обновлен фронтенд** (`src/components/chat/ConceptDropZone.tsx`):
  - Использует новый эндпоинт `/api/kb/upload-file` вместо ручного создания узлов
  - Убрано ограничение в 500 символов
  - Файлы обрабатываются на сервере с полным парсингом и векторизацией

### Changed
- **Миграция с JSON на SQLite**:
  - `api/chat/routes.py` использует `SQLiteNodeRepository` вместо `JSONNodeRepository`
  - `api/kb/routes.py` может использовать SQLite репозиторий
  - Все узлы знаний сохраняются в SQLite таблицу `knowledge_nodes`
- **Обновлена инициализация сервисов** (`api/main.py`):
  - Инициализация `DatabaseManager`, `FAISSStorage`, `ParagraphService` при старте
  - Сервисы доступны через `app.state` для использования в routes
  - Корректное закрытие соединений при shutdown

### Technical Details
- Парсинг текста: разбиение по двойным переносам строк или предложениям (точка + большая буква)
- Векторизация: через SentenceTransformer (многоязычная модель)
- Хранение векторов: BLOB в таблице `vectors` для интеграции с FAISS
- Все параграфы доступны для векторного поиска через FAISS

## [0.0.19]

### Added
- **Анализ мест сохранения данных** (`docs/storage_analysis.md`):
  - Полный анализ загрузки файлов (ConceptDropZone, DragDropUpload)
  - Анализ сохранения в диалоге чата (API routes, JSONNodeRepository, KBService)
  - Анализ других мест сохранения (Projects, User Metrics, Bot Handler)
  - Выявлены проблемы: нет парсинга на параграфы, дублирование хранилищ, нет векторизации
  - Рекомендации по миграции на SQLite и интеграции с FAISS
  - План миграции в 4 этапа

### Removed
- **Удалены неиспользуемые реализации хранилища**: удалены классы DocumentStorage и VectorStorage из `api/storage/db.py`
  - Эти классы не использовались в коде и были legacy кодом
  - Оставлен только DatabaseManager для работы с SQLite
  - BaseStorage сохранен как абстрактный интерфейс для будущих реализаций (PostgreSQL, Qdrant и т.д.)

### Changed
- **BaseStorage восстановлен как абстрактный интерфейс**: 
  - Предоставляет унифицированный интерфейс для разных бэкендов хранилища
  - Позволяет легко переключаться между SQLite, PostgreSQL, Qdrant без изменения бизнес-логики
  - Методы: save(), get(), delete(), list_keys()

### Fixed
- **Исправлена совместимость Redis с Python 3.13**: заменен `aioredis` на `redis.asyncio` (redis>=5.0.0)
  - `aioredis` несовместим с Python 3.13 (ошибка duplicate base class)
  - Используется `redis.asyncio` из пакета `redis[hiredis]>=5.0.0`
  - Обновлен `api/sessions.py` для использования `redis.asyncio`
- **Включена поддержка внешних ключей в SQLite**: добавлен `PRAGMA foreign_keys = ON` в DatabaseManager
  - Требуется для работы CASCADE DELETE в схеме
  - Включено автоматически при подключении к БД

### Added
- **Расширена схема базы данных для хранения узлов знаний и параграфов**:
  - Добавлена таблица `knowledge_nodes` для хранения ConceptNode (замена JSON репозитория)
  - Добавлена таблица `paragraphs` для хранения распарсенных документов и диалогов
  - Обновлена таблица `vectors` для связи с параграфами (для FAISS поиска)
  - Добавлена таблица `node_children` для быстрого доступа к childrenIds
  - Добавлены индексы для оптимизации поиска по узлам, параграфам и векторам
  - Схема поддерживает парсинг документов и диалогов на параграфы для векторного поиска
  - Все параграфы доступны для FAISS поиска через таблицу vectors

### Technical Details
- `knowledge_nodes`: хранит дерево концептов с поддержкой parent-child связей
- `paragraphs`: разбитые на части документы/диалоги с классификацией и fact-checking
- `vectors`: векторные представления параграфов (BLOB) для FAISS индексации
- `node_children`: таблица связей для быстрого доступа к childrenIds без рекурсивных запросов
- Все таблицы связаны через FOREIGN KEY с CASCADE DELETE для целостности данных
- **Добавлены тесты для новой схемы хранения** (`tests/test_storage_schema.py`):
  - Тесты создания таблиц и проверки схемы
  - Тесты работы с knowledge_nodes (создание, parent-child связи)
  - Тесты работы с paragraphs (из узлов и документов, классификация)
  - Тесты работы с vectors (создание, восстановление из BLOB)
  - Тесты каскадного удаления
  - Тесты индексов и поиска

## [0.0.18]

### Fixed
- **Удален атавизм `chat_session` из типов ConceptNode**: ConceptNode не должен знать о сессиях
  - Удален `'chat_session'` из типа `type` в `api/kb/models.py` и `src/types/kb.d.ts`
  - Исправлены использования `node_type="chat_session"` на `node_type="message"` с `role="system"`
  - Обновлены комментарии в методах `get_chat_sessions` и `get_chat_session_by_id` для ясности
  - Сессии управляются через `ChatSessionService`, а не через ConceptNode

## [0.0.17]

### Performance & Optimization
- **Критическая оптимизация Redis**: заменен синхронный redis клиент на async aioredis для неблокирующих операций
  - Все методы SessionManager теперь async (get_session, create_session, update_session, delete_session)
  - Обновлены все вызовы session_manager в api/main.py, api/chat/routes.py, api/bot/handler.py
  - Добавлен shutdown handler для корректного закрытия Redis соединения
- **Оптимизация N+1 queries с учетом пагинации**: устранены множественные запросы в KBService
  - `_collect_tree_nodes`: оптимизирован для пагинации - загружает данные один раз (с кэшем), использует раннюю остановку обхода дерева когда собрано достаточно узлов для пагинации, применяет пагинацию после сортировки
  - `get_node_with_context`: использует батчинг для загрузки parent, children, siblings одним запросом
  - `get_session_messages`: уже использовал один запрос, добавлен комментарий об оптимизации
- **Кэширование JSON репозитория**: добавлено простое in-memory кэширование для частых операций
  - Кэш с TTL 5 секунд для баланса между производительностью и актуальностью данных
  - Автоматическая инвалидация кэша при записи данных
  - Значительно снижает количество файловых операций для get_all() и get_stats()
- **Обновлены зависимости**: redis[hiredis] заменен на aioredis в requirements.txt

### Technical Details
- Все Redis операции теперь неблокирующие, что улучшает производительность при высокой нагрузке
- Оптимизация N+1 queries снижает количество обращений к репозиторию с O(n) до O(1) для операций с деревом узлов
- Кэширование снижает нагрузку на файловую систему для часто запрашиваемых данных

## [0.0.16]

### Refactor
- Реструктурированы типы ConceptNode: удалено дублирование sender и role полей, исправлена логика типов для chat_session
- Улучшена типизация в api/kb/routes.py: добавлен assert для mypy проверки

## [0.0.15]

### Fixed
- Исправлен баг в тестах классификации: несоответствие значений enum ClassificationType для ECOSYSTEM_SOLUTION ("suggested_ecosystem_solution" вместо "ecosystem_solution")

## [0.0.14]

### Testing
- Переработана система тестирования FAISS хранилища: разделены тесты на отдельные файлы по функциональности
- Добавлены тесты базовых операций в `tests/test_paragraph_basics.py`
- Добавлены тесты поиска с фильтрами в `tests/test_paragraph_search.py`
- Добавлены тесты классификации и проверки достоверности в `tests/test_paragraph_classification.py`
- Добавлены тесты обработки краевых случаев в `tests/test_paragraph_edge_cases.py`
- Добавлены тесты работы с разными типами документов в `tests/test_paragraph_document_types.py`
- Удален старый файл `tests/test_paragraph_storage.py`
- Улучшено покрытие тестами для модуля `api/storage/faiss.py`

## [0.0.13]

### Performance & Logging
- Уровень логирования изменен с DEBUG на INFO для уменьшения шума в логах
- Подавлены warnings от внешних библиотек (duckduckgo_search, DeprecationWarning)
- Логи в LLM модуле теперь используют INFO уровень вместо DEBUG

## [0.0.12]

### Fixed
- Исправлена ошибка валидации API чата: поле sessionId в ChatMessageCreate теперь опционально
- Обновлена логика управления сессиями: поддержка как cookies, так и явного указания sessionId в запросе
- Улучшена типизация в api/chat/routes.py для корректной работы с опциональными полями

## [0.0.11]

### Performance & UX
- Оптимизирована загрузка conversation starters в InterviewPage: теперь показываются 3 случайных из localStorage при старте, асинхронно загружаются еще 2 с API и сохраняются в localStorage для будущих сессий
- Убрана блокирующая загрузка starters при переходе на /sources - страница открывается мгновенно

## [0.0.7]

### Testing
- Добавлены E2E тесты роутера в `tests/e2e/router.spec.ts`
- Тесты проверяют навигацию ко всем роутам: `/`, `/sources`, `/funds`, `/knowledge`, `**` (404)
- Проверяют правильную загрузку страниц и URL
- Тесты используют Playwright для полной эмуляции пользовательского поведения

## [0.0.10]

### Performance
- Убрана async загрузка conversation starters в InterviewPage - теперь используются только дефолтные для мгновенной загрузки страницы
- Удалены неиспользуемые компоненты: ConversationTree, ConversationsNav, conceptTreeService, SessionContext
- Оптимизирована производительность загрузки страниц

### UX Improvements
- Проведен аудит usability всех страниц: HomePage, KnowledgeTreePage, FundingPage
- Улучшена навигация и общая UX
- Страницы теперь открываются мгновенно без блокирующих загрузок

## [0.0.9]

### Добавлено
- Новый тип узла 'user_observation' для хранения пользовательских наблюдений
- Новая категория 'metrics' для визуализации метрик и статистики
- Поддержка новых типов в интерфейсе KnowledgeTreePage: добавлены опции 'Наблюдение пользователя' и 'Метрики'
- Реализация сохранения пользовательских наблюдений в user_metrics_service

## [0.0.8]

### Fixed
- Исправлен ChatSidebar: теперь getLastNode правильно получает последний узел чата из conceptTreeService с fallback

## [0.0.7]

### Fixed
- Увеличены размеры иконок в Header и InterviewPage с 20px до 24px для лучшей видимости

## [0.0.6]

### Fixed
- Исправлены импорты в api/__init__.py и api/detect/__init__.py для корректного доступа к модулям detect из тестов

## [0.0.5]

### Fixed
- Исправлены критические проблемы с SSR в i18n.tsx: доступ к localStorage и window теперь происходит только на клиенте с использованием isServer, устранены ReferenceError на сервере, исправлена инициализация языка в onMount

## [0.0.4]

### Fixed
- Исправлена критическая проблема с SSR в InterviewPage.tsx: инициализация sessionId теперь происходит в onMount, используется isServer вместо typeof window, устранены ReferenceError на сервере

## [0.0.3]

### Добавлено
- Респонсивный заголовок с иконками и тултипами для мобильных устройств
- Иконки для разделов: Источники, Знания, Вложения
- Скрытие текста навигации на экранах шириной менее 768px
- возможность продолжать диалог от любой ноды из древа знаний
- возможность удалять ноды из древа знаний

## [0.0.2]

### Добавлено
- пользовательские сессии
- хранимые беседы
- поддержка Telegram ID

## [0.0.1]

### Добавлено
- Система запоминания цепочки сообщений для веб-чата и Telegram бота
- Механизм умного сжатия истории: последние 20 сообщений + сводка старых через LLM
- Модуль `api/chat/context_builder.py` с функциями для построения контекста
- Endpoint `/api/chat/session/{sessionId}/history` для получения истории чата
- Загрузка истории чата при монтировании компонента InterviewPage.tsx
- Параметры `conversation_summary` и `recent_messages` в промпте `simbio_expert.txt`
- Сохранение и восстановление ID сессии в localStorage для веб-чата

### Изменения
- Обновлен `api/chat/routes.py` для использования новой системы контекста
- Обновлен `api/bot/handler.py` для использования новой системы контекста
- Улучшена структура промпта с разделением на сводку и последние сообщения
- Добавлена условная вставка секций контекста при отсутствии данных
- Обновлен `InterviewPage.tsx` для использования localStorage для хранения ID сессии

### Fixed
- Исправлена проблема с потерей контекста между сообщениями в чате
- Исправлена проблема с отсутствием памяти у Telegram бота о предыдущих сообщениях
- Исправлена проблема с инициализацией сессии в веб-чате