---
description: Python —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –¥–ª—è core –∏ migrator –ø—Ä–æ–µ–∫—Ç–æ–≤
globs: core/**/*.py,migrator/**/*.py
alwaysApply: true
---

# üêç Python Standards

## üìã Code Style
- **Python 3.12+** required
- **Line length**: 120 characters max
- **Type hints**: Required for all functions
- **Docstrings**: Required for public methods
- **Ruff**: linting and formatting
- **MyPy**: typechecks

## üß™ Testing
- **Pytest** for testing
- **85%+ coverage** required
- Test both positive and negative cases
- Mock external dependencies

## ‚úÖ Good Examples
```python
# Good example
async def create_reaction(
    session: Session,
    author_id: int,
    reaction_data: dict[str, Any]
) -> dict[str, Any]:
    """
    Create a new reaction.

    Args:
        session: Database session
        author_id: ID of the author creating the reaction
        reaction_data: Reaction data

    Returns:
        Created reaction data

    Raises:
        ValueError: If reaction data is invalid
    """
    if not reaction_data.get("kind"):
        raise ValueError("Reaction kind is required")

    reaction = Reaction(**reaction_data)
    session.add(reaction)
    session.commit()

    return reaction.dict()
```

## üîí Security
- **Input validation**: –ö–ª–∏–µ–Ω—Ç –ò —Å–µ—Ä–≤–µ—Ä
- **SQL injection**: –ò—Å–ø–æ–ª—å–∑—É–π ORM, –Ω–µ raw SQL
- **JWT**: + refresh tokens
- **Environment variables**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—å —Å–µ–∫—Ä–µ—Ç—ã

## üìä Performance
- **Async/await**: –î–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π
- **Database**: –ò—Å–ø–æ–ª—å–∑—É–π connection pooling
- **Caching**: Redis –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Monitoring**: –õ–æ–≥–∏—Ä—É–π –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üö´ Anti-patterns
```python
# ‚ùå –ù–ï –¥–µ–ª–∞–π
def bad_function(data):  # –ù–µ—Ç —Ç–∏–ø–æ–≤
    return data.get('key')  # –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

# ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π raw SQL
query = f"SELECT * FROM users WHERE id = {user_id}"  # SQL injection!

# ‚ùå –ù–ï —Ö–∞—Ä–¥–∫–æ–¥—å –∫–æ–Ω—Ñ–∏–≥–∏
DATABASE_URL = "postgresql://user:pass@localhost/db"  # –í .env!
```

## üìù Commit Messages
Follow [Conventional Commits](https://conventionalcommits.org/):
```
feat: add user authentication
fix: resolve database connection issue
docs: update API documentation
test: add tests for reaction system
refactor: improve GraphQL resolvers
```

## Final Checks
```sh
uv run ruff check . --fix
uv run ruff format --line-length 120
uv run mypy .
```